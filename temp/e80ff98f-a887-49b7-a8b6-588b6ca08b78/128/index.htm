<!DOCTYPE HTML><html><head>
<meta http-equiv="Content-Type" content="text/html; charset=unicode">
<title>JNI：Fatal signal 11 (SIGSEGV) at 0x00000008 (code=1)错误的一点认识</title>
    <!--mark |wiz_custom_css| for wizeditor replace it-->
<link rel="stylesheet"  name="wiz_tmp_editor_style" href="index_files/fonts_15.css"><style id="wiz_custom_css">html, body {            font-size: 15px;        }        body {            font-family: Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;            line-height: 1.6;            margin: 0;            padding: 20px 15px;            padding: 1.33rem 1rem;        }        h1, h2, h3, h4, h5, h6 {            margin: 20px 0 10px;            margin: 1.33rem 0 0.667rem;            padding: 0;            font-weight: bold;        }        h1 {            font-size: 21px;            font-size: 1.4rem;        }        h2 {            font-size: 20px;            font-size: 1.33rem;        }        h3 {            font-size: 18px;            font-size: 1.2rem;        }        h4 {            font-size: 17px;            font-size: 1.13rem;        }        h5 {            font-size: 15px;            font-size: 1rem;        }        h6 {            font-size: 15px;            font-size: 1rem;            color: #777777;            margin: 1rem 0;        }        div, p, ul, ol, dl, li {            margin: 0;        }        blockquote, table, pre, code {            margin: 8px 0;        }        ul, ol {            padding-left: 32px;            padding-left: 2.13rem;        }        blockquote {            padding: 0 12px;            padding: 0 0.8rem;        }        blockquote > :first-child {            margin-top: 0;        }        blockquote > :last-child {            margin-bottom: 0;        }        img {            border: 0;            max-width: 100%;            height: auto !important;            margin: 2px 0;        }        table {            border-collapse: collapse;            border: 1px solid #bbbbbb;        }        td, th {            padding: 4px 8px;            border-collapse: collapse;            border: 1px solid #bbbbbb;			        }        @media only screen and (-webkit-max-device-width: 1024px), only screen and (-o-max-device-width: 1024px), only screen and (max-device-width: 1024px), only screen and (-webkit-min-device-pixel-ratio: 3), only screen and (-o-min-device-pixel-ratio: 3), only screen and (min-device-pixel-ratio: 3) {            html, body {                font-size: 17px;            }            body {                line-height: 1.7;                padding: 0.75rem 0.9375rem;                color: #353c47;            }            h1 {                font-size: 2.125rem;            }            h2 {                font-size: 1.875rem;            }            h3 {                font-size: 1.625rem;            }            h4 {                font-size: 1.375rem;            }            h5 {                font-size: 1.125rem;            }            h6 {                color: inherit;            }            ul, ol {                padding-left: 2.5rem;            }            blockquote {                padding: 0 0.9375rem;            }        }</style><style id="wiz_tmp_editor_style" wiz_style= "unsave">html, body {    font-size: 15px;}body {    font-family: Helvetica, 'Hiragino Sans GB', 微软雅黑, 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;    line-height: 1.6;    color: ;    background-color: ;    margin: 0;    padding: 20px 15px;    padding: 1.33rem 1rem;}img{    max-width: 100%;}</style><script type="text/javascript" src="file:///D:\WizNote\WizTools\htmleditor\utils.js" wiz_style="unsave" charset="utf-8"></script><script type="text/javascript" src="file:///D:\WizNote\WizTools\htmleditor\localize.js" wiz_style="unsave" charset="utf-8"></script><script type="text/javascript" src="file:///D:\WizNote\WizTools\htmleditor\core\wizEditorForPc.js" wiz_style="unsave" charset="utf-8"></script><script type="text/javascript" src="file:///D:\WizNote\WizTools\htmleditor\editorHelper.js" wiz_style="unsave" charset="utf-8"></script><script type="text/javascript" src="file:///E:\我的为知\templates\WizTemplate.js" wiz_style="unsave" charset="utf-8"></script></head>

<body spellcheck="false" ><div class="article_title" style="margin-top: 5px; margin-bottom: 5px; font-stretch: normal; font-size: 20px; line-height: 30px; font-family: 'Microsoft YaHei'; background-color: rgb(255, 255, 255);"><span class="ico ico_type_Repost" style="display: inline-block; width: 19px; height: 19px; margin: 0px 2px 0px 0px; vertical-align: middle; background: url(&quot;&quot;) 0px 0px no-repeat;"></span>&nbsp;<h1 style="margin-top: 0px; margin-bottom: 0px; display: inline; font-weight: normal; font-stretch: normal; font-size: 20px; vertical-align: middle;"><span class="link_title"><a href="http://blog.csdn.net/chenrunhua/article/details/40828659" style="color: rgb(102, 102, 102); text-decoration: none;">JNI：Fatal signal 11 (SIGSEGV) at 0x00000008 (code=1)错误的一点认识</a></span></h1></div><div class="article_manage clearfix" style="padding: 0px 20px 5px; color: rgb(153, 153, 153); font-stretch: normal; font-size: 12px; line-height: 22px; font-family: Arial; text-align: right; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(237, 237, 237); margin-right: -20px; margin-left: -20px; overflow: hidden; background-color: rgb(255, 255, 255);"><div class="article_r"><span class="link_postdate" style="margin: 0px 5px 0px 0px;">2014-11-05 19:16</span>&nbsp;<span class="link_view" title="阅读次数" style="margin: 0px 5px; padding: 0px 0px 0px 14px; background: url(&quot;&quot;) 0% 50% no-repeat;">8238人阅读</span>&nbsp;<span class="link_comments" title="评论次数" style="margin: 0px 5px; padding: 0px 0px 0px 14px; background: url(&quot;&quot;) 0% 50% no-repeat;"><a href="http://blog.csdn.net/chenrunhua/article/details/40828659#comments" style="color: rgb(51, 102, 153); text-decoration: none;">评论</a>(0)</span>&nbsp;<span class="link_collect tracking-ad" data-mod="popu_171" style="margin: 0px 5px;"><a title="收藏" target="_blank" style="color: rgb(51, 102, 153);">收藏</a></span>&nbsp;<span class="link_report" style="margin: 0px 5px;"><a href="http://blog.csdn.net/chenrunhua/article/details/40828659#report" title="举报" style="color: rgb(51, 102, 153); text-decoration: none;">举报</a></span></div></div><div class="category clearfix" style="margin-right: -20px; margin-left: -20px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(237, 237, 237); padding: 5px 20px; color: rgb(51, 51, 51); font-family: Arial, Console, Verdana, 'Courier New'; font-size: 12px; line-height: normal; background-color: rgb(255, 255, 255);"><div class="category_l" style="display: inline-block; font-size: 14px; width: 70px; float: left; line-height: 28px;"><img src="index_files/0.5100731479469687.png" style="border-style: none; border-width: initial; vertical-align: middle;">&nbsp;<span style="display: inline-block; vertical-align: middle;">分类：</span></div><div class="category_r" style="display: inline-block; font-size: 14px; color: rgb(223, 52, 52); float: left; width: 637.2px;"><label style="display: inline-block; margin-left: 15px; cursor: pointer; line-height: 28px; position: relative;">android（28）&nbsp;<img class="arrow-down" src="index_files/0.7076733373105526.png" style="border-style: none; border-width: initial; display: inline;"></label></div></div><div id="article_content" class="article_content" style="margin-top: 20px; font-stretch: normal; font-size: 14px; line-height: 26px; font-family: Arial; color: rgb(51, 51, 51); background-color: rgb(255, 255, 255);"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 最近做的一个东西需要jni去实现，对于一个我这样用惯了java，习惯了debug的人来说，用NDK，使用C/C++去编程是件很苦逼的事情，但是最苦逼的事情在于内存错误发生后如何排查，尤其是 Fatal signal 11 (SIGSEGV)这个错误尤其恼人，报出来之后程序就会崩溃，定位还不好定位，刚开始发生这样的错误时候，只能去到处加log，到处屏蔽代码去找问题发生的地方，效率比较低，并且很难找到问题真正出在哪，后来慢慢找到一些方法，可以相对比较快的定位到问题源头，一般情况下能相对容易的发现问题到底出在哪。下面简单的说说：<br><br>1：首先在logcat中加入debug(方法如图所示):<br><br><img src="index_files/0.46863509132526815.png" alt="" height="356" width="907" style="border-style: none; border-width: initial;"><br><p style="padding-top: 0px; padding-bottom: 0px;">2：在运行后报错中会在debug中找到类似这样的一串错误</p><p style="padding-top: 0px; padding-bottom: 0px;"><img src="index_files/0.5562631799839437.png" alt="" height="445" width="445" style="border-style: none; border-width: initial;"><br></p><br>看到这个长长的错误，不要慌，我们就要拿着这个错误去分析：<br>首先，从这个长长的串中找到有用的信息<br>10-28 12:39:17.779: I/DEBUG(7749): signal 11 (SIGSEGV), code 1 (SEGV_MAPERR), fault addr deadbaad<br>10-28 12:39:17.779: I/DEBUG(7749):&nbsp; r0 00000027&nbsp; r1 deadbaad&nbsp; r2 a0000000&nbsp; r3 00000000<br>10-28 12:39:17.779: I/DEBUG(7749):&nbsp; r4 00000001&nbsp; r5 00000000&nbsp; r6 44bc8c10&nbsp; r7 44984e64<br>10-28 12:39:17.779: I/DEBUG(7749):&nbsp; r8 44bc8b70&nbsp; r9 44984e54&nbsp; 10 44984e3c&nbsp; fp 800a5368<br>10-28 12:39:17.779: I/DEBUG(7749):&nbsp; ip afd46668&nbsp; sp 44bc8ae0&nbsp; lr afd191d9&nbsp; pc afd15ca4&nbsp; cpsr 60000030<br>10-28 12:39:17.779: I/DEBUG(7749):&nbsp; d0&nbsp; 646f423262287964&nbsp; d1&nbsp; 6f42796f72747365<br>10-28 12:39:17.779: I/DEBUG(7749):&nbsp; d2&nbsp; 646e412f65737062&nbsp; d3&nbsp; 6850656e69676e32<br>10-28 12:39:17.779: I/DEBUG(7749):&nbsp; d4&nbsp; 786f427363697379&nbsp; d5&nbsp; 736e657478454432<br>10-28 12:39:17.779: I/DEBUG(7749):&nbsp; d6&nbsp; 2f696e6a2f6e6f69&nbsp; d7&nbsp; 79442f4432786f42<br>10-28 12:39:17.779: I/DEBUG(7749):&nbsp; d8&nbsp; 42ce94f34e6e6b28&nbsp; d9&nbsp; 3c8888893c888888<br>10-28 12:39:17.779: I/DEBUG(7749):&nbsp; d10 c26f7c303f800000&nbsp; d11 3fed9bafc26f7e0e<br>10-28 12:39:17.779: I/DEBUG(7749):&nbsp; d12 0000000000000000&nbsp; d13 0000000000000000<br>10-28 12:39:17.779: I/DEBUG(7749):&nbsp; d14 0000000000000000&nbsp; d15 0000000000000000<br>10-28 12:39:17.779: I/DEBUG(7749):&nbsp; d16 3ef18d523ae9735c&nbsp; d17 3fca68bfcfa2d635<br>10-28 12:39:17.779: I/DEBUG(7749):&nbsp; d18 bf29fd09783e4216&nbsp; d19 3ec6cd878c3b46a7<br>10-28 12:39:17.779: I/DEBUG(7749):&nbsp; d20 3f826164f3f641b5&nbsp; d21 3f5e8ec8e86d933e<br>10-28 12:39:17.779: I/DEBUG(7749):&nbsp; d22 3e3782e7e0000000&nbsp; d23 3e33401660000000<br>10-28 12:39:17.779: I/DEBUG(7749):&nbsp; d24 3fca99a880000000&nbsp; d25 bfca99a880000000<br>10-28 12:39:17.779: I/DEBUG(7749):&nbsp; d26 be3ff77520000000&nbsp; d27 3ef99342e0ee5069<br>10-28 12:39:17.779: I/DEBUG(7749):&nbsp; d28 bfa2b4442c6a6c2f&nbsp; d29 0000000000000000<br>10-28 12:39:17.779: I/DEBUG(7749):&nbsp; d30 0000000000000000&nbsp; d31 0000000000000000<br>10-28 12:39:17.779: I/DEBUG(7749):&nbsp; scr 80000012<br><span style="color: rgb(255, 0, 0);">10-28 12:39:17.829: I/DEBUG(7749):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #00&nbsp; pc 00015ca4&nbsp; /system/lib/libc.so<br>10-28 12:39:17.829: I/DEBUG(7749):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #01&nbsp; pc 0001c92c&nbsp; /system/lib/libc.so</span><br>主要看红色加粗的地方（#打头的部分），这个表明了错误发生的原因和地方，因此问题分析从这个入手，一般情况下这个红色加粗部分有两种情况，一种情况就如上边的错误一样，报错都来在系统的so包，并且没有进一步详细的信息，这种情况下，问题可能出现的都比较弱智，一般主要去分析下jni入口函数，反调，数组是否越界，使用已经delete的资源等这些常规错误，稍微注意下可能就能找到源头，也可能问题非常棘手，要拼人品了哈。<br>第二种报错可能是类似与这样：<br>#00&nbsp; pc 00011784&nbsp; /system/lib/libc.so (pthread_attr_init)<br>#01&nbsp; pc 000de128&nbsp; /data/data/com.test.android.Test/lib/libDemo.so (_ZN6Demo6Test4InitEv)<br>#02&nbsp; pc 000def90&nbsp; /data/data/com.test.android.Test/lib/libDemo.so (_ZN6Demo16TestDemo4InitESsiiil)<br><p style="padding-top: 0px; padding-bottom: 0px;">可以看到错误直接报道咱们自己的so包，并且Test4Init能看到是Test类下的init方法，越上边是问题的越根源，这样我们就可以按图索骥，从Test的init方法里去仔细排查错误的原因，可以大大减少排查耗费的时间。</p><p style="padding-top: 0px; padding-bottom: 0px;">接下来比较高深的是通过汇编方式找具体的错误，目前还没用到，定位到方法基本可以解决问题，大家有兴趣的可以看下后边给出的参考文章。<br></p><p style="padding-top: 0px; padding-bottom: 0px;">目前在最近的工作中通过这一方法基本可以较快的找到问题的发生地方，比之前各种log和各种屏代码效率高了很多，如果大家还有更好的办法希望留言讨论一下。</p><p style="padding-top: 0px; padding-bottom: 0px;">参考文章：http://blog.csdn.net/helldevil/article/details/6682211</p><br><div style="color:gray"><small>来源：&nbsp;<a href="http://blog.csdn.net/chenrunhua/article/details/40828659">http://blog.csdn.net/chenrunhua/article/details/40828659</a></small></div></div></body></html>